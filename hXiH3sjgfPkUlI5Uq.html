<html><head><base href="https://juegodetriple.com/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tres en Ralla - Modo Oscuro Moderno</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-color: #0f0e17;
    --text-color: #fffffe;
    --primary-color: #ff8906;
    --secondary-color: #f25f4c;
    --tertiary-color: #e53170;
  }

  body {
    font-family: 'Poppins', sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    background-color: var(--bg-color);
    color: var(--text-color);
    overflow: hidden;
  }

  .container {
    text-align: center;
    background: rgba(255, 255, 255, 0.05);
    padding: 2rem;
    border-radius: 20px;
    box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
    border: 1px solid rgba(255, 255, 255, 0.18);
  }

  h1 {
    font-size: 3rem;
    margin-bottom: 30px;
    color: var(--primary-color);
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  }

  .menu, .game, .difficulty {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .menu, .difficulty {
    margin-bottom: 30px;
  }

  .btn {
    font-size: 1.1rem;
    padding: 12px 24px;
    margin: 12px;
    background-color: var(--primary-color);
    color: var(--bg-color);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 50px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 4px 15px rgba(255, 137, 6, 0.3);
  }

  .btn:hover {
    background-color: var(--secondary-color);
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(242, 95, 76, 0.4);
  }

  .board {
    display: grid;
    grid-template-columns: repeat(3, 100px);
    grid-gap: 10px;
    margin-bottom: 30px;
  }

  .cell {
    width: 100px;
    height: 100px;
    background-color: rgba(255, 255, 255, 0.1);
    border: 2px solid var(--primary-color);
    font-size: 3rem;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 15px;
  }

  .cell:hover {
    background-color: rgba(255, 255, 255, 0.2);
    transform: scale(1.05);
  }

  #status {
    font-size: 1.5rem;
    margin-bottom: 20px;
    color: var(--tertiary-color);
  }

  @keyframes winner {
    0% { transform: scale(1); }
    50% { transform: scale(1.1) rotate(5deg); }
    100% { transform: scale(1) rotate(0deg); }
  }

  .winner {
    animation: winner 0.5s ease infinite;
    background-color: var(--secondary-color);
    color: var(--text-color);
  }

  .back-btn {
    font-size: 0.9rem;
    padding: 10px 20px;
    margin-top: 20px;
    background-color: transparent;
    color: var(--text-color);
    border: 2px solid var(--text-color);
    cursor: pointer;
    transition: all 0.3s ease;
    border-radius: 50px;
  }

  .back-btn:hover {
    background-color: var(--text-color);
    color: var(--bg-color);
  }

  @keyframes float {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-20px); }
    100% { transform: translateY(0px); }
  }

  .floating {
    animation: float 6s ease-in-out infinite;
  }

  .difficulty h2 {
    color: var(--secondary-color);
    margin-bottom: 20px;
  }

  .scores {
    display: flex;
    justify-content: space-around;
    margin-bottom: 20px;
    font-size: 1.2rem;
  }

  .score {
    padding: 10px;
    background-color: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
  }

  .player {
    color: var(--primary-color);
    font-weight: 600;
    margin-right: 10px;
  }

  @media (max-width: 480px) {
    .container {
      padding: 1rem;
    }

    h1 {
      font-size: 2rem;
    }

    .btn {
      font-size: 0.9rem;
      padding: 10px 20px;
    }

    .board {
      grid-template-columns: repeat(3, 80px);
    }

    .cell {
      width: 80px;
      height: 80px;
      font-size: 2.5rem;
    }
  }
</style>
</head>
<body>
<div class="container" id="main-container">
  <h1>Tres en Ralla</h1>
  <div class="menu floating" id="menu">
    <button class="btn" id="pvp">Jugar vs Persona</button>
    <button class="btn" id="pvc">Jugar vs Consola</button>
  </div>
  <div class="difficulty floating" id="difficulty" style="display: none;">
    <h2>Selecciona la dificultad</h2>
    <button class="btn" id="easy">Fácil</button>
    <button class="btn" id="medium">Medio</button>
    <button class="btn" id="hard">Avanzado</button>
    <button class="back-btn" id="back-to-menu">Volver al Menú</button>
  </div>
  <div class="game" id="game" style="display: none;">
    <div class="scores" id="scores" style="display: none;">
      <div class="score">
        <span class="player">Jugador X:</span>
        <span id="scoreX">0</span>
      </div>
      <div class="score">
        <span class="player">Jugador O:</span>
        <span id="scoreO">0</span>
      </div>
    </div>
    <div class="board" id="board">
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
      <div class="cell" data-cell></div>
    </div>
    <div id="status">¡Turno del Jugador X!</div>
    <button class="back-btn" id="back-to-menu-from-game">Volver al Menú</button>
  </div>
</div>

<script>
const mainContainer = document.getElementById('main-container');
const menu = document.getElementById('menu');
const difficulty = document.getElementById('difficulty');
const game = document.getElementById('game');
const board = document.getElementById('board');
const cells = document.querySelectorAll('[data-cell]');
const status = document.getElementById('status');
const pvpButton = document.getElementById('pvp');
const pvcButton = document.getElementById('pvc');
const easyButton = document.getElementById('easy');
const mediumButton = document.getElementById('medium');
const hardButton = document.getElementById('hard');
const backToMenuButton = document.getElementById('back-to-menu');
const backToMenuFromGameButton = document.getElementById('back-to-menu-from-game');

let currentPlayer = 'X';
let gameActive = true;
let isComputerOpponent = false;
let computerDifficulty = 'easy';
let scoreX = 0;
let scoreO = 0;
const scoreXElement = document.getElementById('scoreX');
const scoreOElement = document.getElementById('scoreO');
const scoresContainer = document.getElementById('scores');

const winningCombinations = [
  [0, 1, 2],
  [3, 4, 5],
  [6, 7, 8],
  [0, 3, 6],
  [1, 4, 7],
  [2, 5, 8],
  [0, 4, 8],
  [2, 4, 6]
];

function startGame(vsComputer) {
  if (vsComputer) {
    menu.style.display = 'none';
    difficulty.style.display = 'flex';
  } else {
    menu.style.display = 'none';
    game.style.display = 'flex';
    isComputerOpponent = false;
    scoresContainer.style.display = 'flex';
    resetGame();
  }
  mainContainer.classList.remove('floating');
}

function setDifficulty(level) {
  computerDifficulty = level;
  difficulty.style.display = 'none';
  game.style.display = 'flex';
  isComputerOpponent = true;
  resetGame();
  mainContainer.classList.remove('floating');
}

function handleCellClick(e) {
  const cell = e.target;
  const cellIndex = Array.from(cells).indexOf(cell);

  if (cell.textContent !== '' || !gameActive) return;

  placeMark(cell, currentPlayer);

  if (checkWin()) {
    endGame(false);
  } else if (checkDraw()) {
    endGame(true);
  } else {
    swapTurns();
    if (isComputerOpponent && currentPlayer === 'O') {
      setTimeout(computerMove, 500);
    }
  }
}

function placeMark(cell, mark) {
  cell.textContent = mark;
}

function swapTurns() {
  currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
  status.textContent = `Turno del Jugador ${currentPlayer}`;
}

function checkWin() {
  return winningCombinations.some(combination => {
    return combination.every(index => {
      return cells[index].textContent === currentPlayer;
    });
  });
}

function checkDraw() {
  return Array.from(cells).every(cell => cell.textContent !== '');
}

function endGame(draw) {
  if (draw) {
    status.textContent = '¡Empate!';
  } else {
    status.textContent = `¡Jugador ${currentPlayer} ha ganado!`;
    highlightWinnerCells();
    if (currentPlayer === 'X') {
      scoreX++;
    } else {
      scoreO++;
    }
    updateScoreDisplay();
  }
  gameActive = false;
  setTimeout(resetGame, 2000);
}

function highlightWinnerCells() {
  winningCombinations.forEach(combination => {
    if (combination.every(index => cells[index].textContent === currentPlayer)) {
      combination.forEach(index => cells[index].classList.add('winner'));
    }
  });
}

function resetGame() {
  cells.forEach(cell => {
    cell.textContent = '';
    cell.classList.remove('winner');
  });
  currentPlayer = 'X';
  gameActive = true;
  status.textContent = `¡Turno del Jugador X!`;
  if (isComputerOpponent && currentPlayer === 'O') {
    setTimeout(computerMove, 500);
  }
}

function computerMove() {
  if (!gameActive) return;

  let move;
  switch (computerDifficulty) {
    case 'easy':
      move = getRandomMove();
      break;
    case 'medium':
      move = Math.random() < 0.5 ? getBestMove() : getRandomMove();
      break;
    case 'hard':
      move = getBestMove();
      break;
  }

  if (move !== null) {
    placeMark(cells[move], 'O');
    if (checkWin()) {
      endGame(false);
    } else if (checkDraw()) {
      endGame(true);
    } else {
      swapTurns();
    }
  }
}

function getRandomMove() {
  let availableMoves = Array.from(cells).map((cell, index) => cell.textContent === '' ? index : null).filter(index => index !== null);
  return availableMoves[Math.floor(Math.random() * availableMoves.length)];
}

function getBestMove() {
  let bestScore = -Infinity;
  let bestMove;
  for (let i = 0; i < 9; i++) {
    if (cells[i].textContent === '') {
      cells[i].textContent = 'O';
      let score = minimax(cells, 0, false);
      cells[i].textContent = '';
      if (score > bestScore) {
        bestScore = score;
        bestMove = i;
      }
    }
  }
  return bestMove;
}

function minimax(board, depth, isMaximizing) {
  let result = checkWinner();
  if (result !== null) {
    return result;
  }

  if (isMaximizing) {
    let bestScore = -Infinity;
    for (let i = 0; i < 9; i++) {
      if (board[i].textContent === '') {
        board[i].textContent = 'O';
        let score = minimax(board, depth + 1, false);
        board[i].textContent = '';
        bestScore = Math.max(score, bestScore);
      }
    }
    return bestScore;
  } else {
    let bestScore = Infinity;
    for (let i = 0; i < 9; i++) {
      if (board[i].textContent === '') {
        board[i].textContent = 'X';
        let score = minimax(board, depth + 1, true);
        board[i].textContent = '';
        bestScore = Math.min(score, bestScore);
      }
    }
    return bestScore;
  }
}

function checkWinner() {
  for (let combo of winningCombinations) {
    if (cells[combo[0]].textContent === cells[combo[1]].textContent &&
        cells[combo[1]].textContent === cells[combo[2]].textContent &&
        cells[combo[0]].textContent !== '') {
      return cells[combo[0]].textContent === 'O' ? 10 : -10;
    }
  }
  if (checkDraw()) return 0;
  return null;
}

function updateScoreDisplay() {
  scoreXElement.textContent = scoreX;
  scoreOElement.textContent = scoreO;
}

function backToMainMenu() {
  game.style.display = 'none';
  difficulty.style.display = 'none';
  menu.style.display = 'flex';
  scoresContainer.style.display = 'none';
  resetGame();
  scoreX = 0;
  scoreO = 0;
  updateScoreDisplay();
  mainContainer.classList.add('floating');
}

cells.forEach(cell => cell.addEventListener('click', handleCellClick));
pvpButton.addEventListener('click', () => startGame(false));
pvcButton.addEventListener('click', () => startGame(true));
easyButton.addEventListener('click', () => setDifficulty('easy'));
mediumButton.addEventListener('click', () => setDifficulty('medium'));
hardButton.addEventListener('click', () => setDifficulty('hard'));
backToMenuButton.addEventListener('click', backToMainMenu);
backToMenuFromGameButton.addEventListener('click', backToMainMenu);
</script>
</body></html>